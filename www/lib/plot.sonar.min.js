/**
 * plot.sonar.js
 * =====================
 * This is packager to create a dual-scaled sonar plot
 * using d3.sonar.js
 *
 * =====================
 * The MIT License (MIT)
 *
 * Copyright (c) 2014 Ashish Singh [ashish.me@outlook.com]
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function(a){function b(i){var k=1000,c=10000,n;var q=[],t=[];var o,s;var e={sonar_el:document.querySelector("#viz-container"),major_el:document.querySelector("#viz-major"),minor_el:document.querySelector("#viz-minor"),PAST_TIME_JAR:19*60*1000,LIVE_TIME_JAR:1*60*1000,colors:{indicator:"#aace00",heading:"#1A68DB"}};var r=function(u){console.log(u)};function m(u){return(u<=180)?((u+180)===360?0:(u+180)):u-180}function p(v){var u=(v<=180)?v+180:v-180;return u}function g(){}function h(w,u){var v={name:"Heading",time:w,value:u,strength:getRandomInt(9,10),is_heading:true};q.push(v);o.purgeOldData(true).addHeading(v);j();return g}function d(x,u,v,y){var w={name:u,time:x,value:v,strength:y,is_detection:true};q.push(w);o.purgeOldData(true).addDetection(w);j();return g}function j(){var u=d3.max(q,function(w){return w.time});var v=q.filter(function(w){return((new Date(u).getTime()-new Date(w.time).getTime())>=e.LIVE_TIME_JAR)});q=q.filter(function(w){return((new Date(u).getTime()-new Date(w.time).getTime())<e.LIVE_TIME_JAR)});v.forEach(function(x,w){if(x.is_heading){s.purgeOldData(true).addHeading(x)}else{s.purgeOldData(true).addDetection(x)}});u=null;v=null}function l(){$(window).resize(function(u){f()})}function f(){var u=$(window).height();$(e.sonar_el).height(u*0.75);u=u*0.75;$(e.minor_el).height(Math.floor(u*0.25));$(e.major_el).height(Math.floor(u*0.75))}g.createPlot=function(){o=d3.sonar().container_el(e.minor_el).xTickValues([0,45,90,135,180,225,270,315,360]).xTickFormat(function(u){return(u<=180)?((u+180)===360?0:(u+180)):u-180}).xTickFormatInverse(function(u){return(u<=180)?u+180:u-180}).yTicks(4).headingKeys({x:"degree",y:"date"}).detectionKeys({x:"degree",y:"date"}).margin({top:25,left:100,bottom:5,right:50}).dataAge(e.LIVE_TIME_JAR).colors(e.colors).yAxisLabel("").onclick(r);s=d3.sonar().container_el(e.major_el).xTickValues([0,45,90,135,180,225,270,315,360]).xTickFormat(function(u){return(u<=180)?((u+180)===360?0:(u+180)):u-180}).xTickFormatInverse(function(u){return(u<=180)?u+180:u-180}).yTicks(8).headingKeys({x:"degree",y:"date"}).showXAxis(false).margin({top:0,left:100,bottom:10,right:50}).detectionKeys({x:"degree",y:"date"}).dataAge(e.PAST_TIME_JAR).colors(e.colors).onclick(r);o();f();l();return g};g.addSelectionListener=function(u){if(!arguments.length){return g}r=u;return g};g.addDetection=function(w,u,v,x){if(!arguments.length){return g}return d(w,u,v,x)};g.addHeading=function(v,u){if(!arguments.length){return g}return h(v,u)};g.options=function(u){if(!arguments.length){return e}$.extend(e,u);return g};g.major_viz=function(){return s};g.minor_viz=function(){return o};return g}a.PlotSonar=b})(window);